---
title: "573 Group Project"
output: pdf_document
date: "`r Sys.Date()`"
---
# The Model

## Preparing the Data

```{r}
data <- read.csv("train.csv")
data[is.na(data)]<-0

# factor the appropriate columns
data$MSSubClass <- factor(data$MSSubClass)
data$MSZoning <- factor(data$MSZoning)
data$Street <- factor(data$Street)
data$Alley <- factor(data$Alley)
data$LotShape <- factor(data$LotShape)
data$LandContour <- factor(data$LandContour)
data$Utilities <- factor(data$Utilities)
data$LotConfig <- factor(data$LotConfig)
data$LandSlope <- factor(data$LandSlope)
data$Neighborhood <- factor(data$Neighborhood)
data$Condition1 <- factor(data$Condition1)
data$Condition2 <- factor(data$Condition2)
data$BldgType <- factor(data$BldgType)
data$HouseStyle <- factor(data$HouseStyle)
data$RoofStyle <- factor(data$RoofStyle)
data$RoofMatl <- factor(data$RoofMatl)
data$Exterior1st <- factor(data$Exterior1st)
data$Exterior2nd <- factor(data$Exterior2nd)
data$MasVnrType <- factor(data$MasVnrType)
data$ExterQual <- factor(data$ExterQual)
data$ExterCond <- factor(data$ExterCond)
data$Foundation <- factor(data$Foundation)
data$BsmtQual <- factor(data$BsmtQual)
data$BsmtCond <- factor(data$BsmtCond)
data$BsmtExposure <- factor(data$BsmtExposure)
data$BsmtFinType1 <- factor(data$BsmtFinType1)
data$BsmtFinType2 <- factor(data$BsmtFinType2)
data$Heating <- factor(data$Heating)
data$HeatingQC <- factor(data$HeatingQC)
data$CentralAir <- factor(data$CentralAir)
data$Electrical <- factor(data$Electrical)
data$KitchenQual <- factor(data$KitchenQual)
data$Functional <- factor(data$Functional)
data$FireplaceQu <- factor(data$FireplaceQu)
data$GarageType <- factor(data$GarageType)
data$GarageFinish <- factor(data$GarageFinish)
data$GarageCond <- factor(data$GarageCond)
data$PoolQC <- factor(data$PoolQC)
data$Fence <- factor(data$Fence)
data$MiscFeature <- factor(data$MiscFeature)
data$SaleType <- factor(data$SaleType)
data$SaleCondition <- factor(data$SaleCondition)
```

## Exploratory visuals

This confirms that the data broadly looks how we expect it to.

```{r}
plot(data$OverallQual,log(data$SalePrice))

bp <- boxplot(log(data$SalePrice) ~ data$Exterior1st, data = data, col = c("lightblue", "darkblue"), xaxt = "n")
tick <- seq_along(bp$names)
axis(1, at = tick, labels = FALSE)
text(tick, par("usr")[3] - 0.3, bp$names, srt = 90, xpd = TRUE)
plot(data$FullBath,log(data$SalePrice))
```
Here, I examine which factor variables might be worth dropping.

```{r}
library(ggplot2)

plotbar <- function(i){
     if (is.factor(get(i))){
         ggplot(data, aes(x=get(i))) + geom_bar() + ggtitle(i)
     }
}
```

Breaking this into two chunks to more easily isolate the function

```{r}
attach(data)
library(gridExtra)

plots <- lapply(names(data),plotbar)
plots[sapply(plots, is.null)] <- NULL # drop the null values
length(plots)
gridExtra::grid.arrange( grobs = plots, nrow = 7) # you might want to run this row separately and use the 'zoom' feature to the right to pop out the result for better visibility
```

## linear regression - Ari

Since the outcome variable is housing prices, we will examine whether log transformation of the outcome variable will better fit our data:

```{r}
attach(data)
linbase <- glm(SalePrice~.-Id,data = data)
linlog <- glm(log(SalePrice)~. -Id, data = data)
summary(linbase)
summary(linlog)
```

```{r}
library(boot)
m.cv<- try(cv.glm(data, linbase, K=2)) #First try
class(m.cv) #Sometimes error, sometimes list
while (inherits(m.cv, "try-error") ) {
m.cv<- try(cv.glm(data, linbase, K=2))
}
class(m.cv)
#cv.glm(data , linbase , K = 5)$delta[1]
#cv.glm(data , linlog , K = 5)$delta[1]
```


## LASSO/ridge/elastic net - Ari

## PCA - Ari

## regression trees and random forests, - Ari

## Boosting - Ari


```{r}
# Clearing data - Lily
library(forcats)

#SaleCondition
plotbar("SaleCondition") #to find how to aggregate
fct_collapse(SaleCondition,Abnormal= c("Abnorml","AdjLand","Alloca","Family"),Normal="Normal", Partial="Partial")

#SaleType
plotbar("SaleType") #to find how to aggregate
fct_collapse(SaleType,New = "New",Warranty = c("WD","CWD", "VWD"), Others = c ("COD", "Con", "ConLw", "ConLl", "ConLD", "Oth"))

#Fence
plotbar("Fence") #to find how to aggregate
fct_collapse(Fence,No ="0",Good = c("GdPrv","GdWo"),Mini = c("MnPrv","MnWw"))

#GarageType
plotbar("GarageType")
fct_collapse(GarageType,Attached = c("Attchd", "BuiltIn"),Detached = "Detchd",Other = c("CarPort","Basment","2Types"),None = "0")


#FireplaceQu
plotbar("FireplaceQu")
fct_collapse(FireplaceQu,Good=c("Ex","Gd"), Aver = c("TA","Fa"), Bad=c("Po","0"))

#Electrical
plotbar("Electrical")
fct_collapse(Electrical,Stand = "SBrkr", Fuse_Mix = c("FuseA","FuseF","FuseP", "Mix"))

#HeatingQC
plotbar("HeatingQC")
fct_collapse(HeatingQC,Good =  c("Ex","Gd"),	Ave = "TA",	Bad = c("Fa","Po"))

#"BsmtExposure"
plotbar("BsmtExposure")
fct_collapse(BsmtExposure, Good =  "Gd",AbovMin = c("Av","Mn"), NoE = "No", NoB = "0")

#"BsmtCond"
plotbar("BsmtCond")
fct_collapse(BsmtCond, Typical = "TA",NonTy = c("Ex","Gd","Fa","Po","0"))

#"BsmtQual"
plotbar("BsmtQual")
fct_collapse(BsmtQual,Good=c("Ex","Gd"),	Aver = c("TA","Fa"),	Bad=c("Po","0"))


#"Foundation"
plotbar("Foundation")
fct_collapse(Foundation,BrkTil= "BrkTil",CBlock = "CBlock",PConc = "PConc",Oth = c("Slab","Stone","Wood"))

#"ExterCond"
plotbar("ExterCond")
fct_collapse(ExterCond,Good =  c("Ex","Gd"),	Ave = "TA",	Bad = c("Fa","Po"))

#ExterQual
plotbar("ExterQual")
fct_collapse(ExterQual,Good =  c("Ex","Gd"), Ave = "TA",	Bad = c("Fa","Po"))

#"MasVnrType"
plotbar("MasVnrType")
fct_collapse(MasVnrType, Brk= c("BrkCmn","BrkFace")	,Stone = "Stone",	Other = c("CBlock", "None"))

#"Exterior1st"
plotbar("Exterior1st")
fct_collapse(Exterior1st, Brk = c("BrkComm","BrkFace"), Wood = c("Wd Sdng", "WdShing","HdBoard","Plywood"), Vinyl = "VinylSd", Metal = "MetalSd", Stone_Cement = c("Stone","CemntBd", "CBlock","PreCast"), Other = c("AsbShng","AsphShn","ImStucc","Stucco","Other") )

#"Exterior2nd"
plotbar("Exterior2nd")
fct_collapse(Exterior2nd, Brk = c("BrkComm","BrkFace"), Wood = c("Wd Sdng", "WdShing","HdBoard","Plywood"), Vinyl = "VinylSd", Metal = "MetalSd", Stone_Cement = c("Stone","CemntBd", "CBlock","PreCast"), Other = c("AsbShng","AsphShn","ImStucc","Stucco","Other") )

#"RoofStyle"
plotbar("RoofStyle")
fct_collapse(RoofStyle,Gable = "Gable",	Hip = "Hip",	Others = c ("Flat","Gambrel","Mansard","Shed"))

#"HouseStyle"
plotbar("HouseStyle")
fct_collapse(HouseStyle,OneStory = "1Story", OnenHalfStory = c ("1.5Fin", "1.5Unf")	, TwoStory = "2Story"	, TwonHalfStory = c ("2.5 Fin", "2.5Unf"),	Split = c("SFoyer", "SLvl"))


#"BldgType"
plotbar("BldgType")
fct_collapse(BldgType,OneFam = "1Fam",	TwoFam = c ( "2FmCon", "Duplex") 	, Twn = c ( "TwnhsE", "Twnhsl"))

#"Condition1"
plotbar("Condition1")
fct_collapse(Condition1, Norm = "Norm", Other = c ("Artery", "Feedr", "RRNn", "RRAn", "PosN","PosA", "RRNe", "RRAe"))

#"Neighborhood"
plotbar("Neighborhood")
fct_collapse(Neighborhood, North = c ("NWAmes", "NAmes", "NoRidge", "NPkVill", "NridgHt", "Somerst"),	West = c ("Sawyer", "SawyerW", "Gilbert", "SWISU", "Timber"),	East = c ("Edwards", "BrkSide", "Blueste", "BrDale", "IDOTRR", "MeadowV"),	Central = c("OldTown", "CollgCr", "Crawfor", "Mitchel"),	HighEnd = c ("Veenker", "StoneBr", "ClearCr"), Other = c ("Blmngtn"))

#"LotConfig"
plotbar("LotConfig")
fct_collapse(LotConfig,Standard = c ("Inside", "Corner"),	Premium = c ("CulDSac", "FR2", "FR3"))

#"LotShape"
plotbar("LotShape")
fct_collapse(LotShape,Regular = "Reg", Irregular = c("IR1","IR2","IR3"))

#"MSZoning"
plotbar("MSZoning")
fct_collapse(MSZoning,Residentiallow = c ("RL", "RP")	,ResidentialMedHi = c ("RM", "RH") ,	Other = c( "FV", "A", "I", "C")	)

```

